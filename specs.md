# Copy Codes - VSCode Extension 规格文档

## 概述

一个 VSCode/Cursor 扩展，允许用户在文件资源管理器中选中文件或文件夹，通过右键菜单将内容复制到剪贴板，并在新标签页中预览。

## 功能需求

### 核心功能

1. **右键菜单集成**
   - 在文件资源管理器的右键菜单中添加 "Copy Codes" 选项
   - 支持单选和多选文件/文件夹

2. **递归文件读取**
   - 对于选中的文件：直接读取内容
   - 对于选中的文件夹：递归读取所有子文件内容

3. **格式化输出**
   - 使用 Markdown 代码块格式
   - 文件路径作为代码块标识符
   - 路径使用相对路径（相对于工作区根目录）

4. **剪贴板复制**
   - 将格式化后的内容复制到系统剪贴板

5. **预览标签页**
   - 打开新标签页显示复制的内容
   - 内容以只读形式展示

6. **智能文件检测**
   - 自动检测并跳过二进制文件
   - 基于扩展名黑名单 + 内容分析

7. **`.copyignore` 支持**
   - 支持 gitignore 语法
   - 从工作区根目录读取

## 输出格式

```
```file1.md
content from file1.md
```

```folder/file2.json
content from folder/file2.json
```
```

## 技术规格

### 扩展激活
- 激活事件：`onStartupFinished`

### 命令
| 命令 ID | 标题 | 描述 |
|---------|------|------|
| `copy-codes.copyToClipboard` | Copy Codes | 复制选中文件/文件夹内容到剪贴板 |

### 快捷键
| 平台 | 快捷键 |
|------|--------|
| macOS | `⇧ ⌃ ⌘ L` |
| Windows/Linux | `Ctrl + Shift + Alt + L` |

### 菜单贡献
- `explorer/context`: 文件资源管理器右键菜单

### 文件处理

#### 二进制文件检测
1. **扩展名黑名单**：图片、音视频、压缩包、可执行文件等
2. **内容分析**：检测空字节和不可打印字符比例

#### 排除规则
- 配置中的 `excludePatterns`
- `.copyignore` 文件（gitignore 语法）

### 错误处理
- 文件读取失败时显示警告消息
- 空选择时显示提示消息
- 大文件自动跳过

## 配置选项

| 配置项 | 类型 | 默认值 | 描述 |
|--------|------|--------|------|
| `copy-codes.excludePatterns` | `string[]` | `["node_modules", ".git", ...]` | 排除的目录/文件模式 |
| `copy-codes.maxFileSize` | `number` | `1048576` (1MB) | 单文件最大大小（字节） |

## 依赖

- VSCode API: ^1.74.0
- Node.js 内置模块: `fs`, `path`

## 开发状态

### ✅ 已完成
- [x] 基础项目结构
- [x] 右键菜单集成
- [x] 单文件复制
- [x] 多文件复制
- [x] 文件夹递归读取
- [x] 剪贴板复制
- [x] 新标签页预览
- [x] 智能二进制检测
- [x] `.copyignore` 支持
- [x] 快捷键支持

### 🔮 未来计划
- [ ] 自定义输出格式模板
- [ ] 文件内容搜索过滤
- [ ] 行号显示选项
